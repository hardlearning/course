# 09.Linux网络编程

## 三次握手和四次挥手

![tcp-connection](https://gitlab.com/iknowledge/CourseImage/-/raw/main/Network/tcp-connection.png)

- 括号里的数字是数据长度
- mss：最大报文长度，告诉对方我这边最多一次能收多少，你不能超过这个长度。

## 滑动窗口

主要作用：滑动窗口主要是进行流量控制的。

## 粘包

对方连续发送了两次数据，然后读数据的时候第一次没有读完，剩余的数据在第二次读走了，这种情况就叫做粘包。

解决方法：
1. 包头+数据：包头可以用四个字节长度，例如：00100123456789
2. 添加结尾标记（不推荐，效率低）
3. 数据包定长

## 多进程

使用多进程：让父进程监听接受新的连接，子进程处理新的连接（接收和发送数据）；父进程还负责回收子进程。

父子进程能够共享的：文件描述符（子进程复制父进程的文件描述符）、mmap共享映射区

## 多线程

- 子线程不能关闭监听文件描述符lfd，原因是子线程和主线程共享文件描述符而不是复制
- 主线程不能关闭cfd，因为主线程和子线程共享一个cfd，close之后cfd就会被真正关闭