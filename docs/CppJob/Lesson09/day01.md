# 09.Linux网络编程

## OSI七层模型：物数网传会表应 

- 应用层：为用户提供各种应用服务，email服务，ftp服务，ssh服务
- 表示层：进行编解码和翻译工作
- 会话层：建立会话和保持会话
- 传输层：定义了端到端的传输，TCP、UDP协议
- 网络层：定义了点到点的传输，IP协议————路由器
- 数据链路层：数据校验，定义了网络传输的基本单位————帧，ARP协议、 RARP协议
- 物理层：通信介质————双绞线、光纤、调制调解器，将模拟信号转换为数字信号

## TCP四层模型：

- 应用层: 对应会话层、表示层和应用层
- 传输层: 对应传输层
- 网络层: 对应网络层
- 网络接口层: 对应于物理层和数据链路层

数据通信过程：在发送方是数据层层打包过程, 在接收方是层层解包过程。

## 以太帧格式

以太网帧格式就是包装在网络接口层(数据链路层)的协议

![ethernet-frame](https://gitlab.com/iknowledge/CourseImage/-/raw/main/Network/ethernet-frame.png)

- 源地址和目的地址是指网卡的硬件地址（也叫MAC地址），长度是48位，是在网卡出厂时固化的。
- 协议类型有三种值，分别对应IP、ARP、RARP。帧尾是CRC校验码。
- 以太网帧中的数据长度规定最小46字节，最大1500字节，ARP和RARP数据包的长度不够46字节，要在后面补填充位。最大值1500称为以太网的最大传输单元（MTU），不同的网络类型有不同的MTU，如果一个数据包从以太网路由到拨号链路上，数据包长度大于拨号链路的MTU，则需要对数据包进行分片（fragmentation）。ifconfig命令输出中也有“MTU:1500”。注意，MTU这个概念指数据帧中有效载荷的最大长度，不包括帧头长度。

### 以ARP为例介绍以太网帧格式

 ARP协议：通过IP地址获得MAC地址

![ARP-IP-MAC](https://gitlab.com/iknowledge/CourseImage/-/raw/main/Network/ARP-IP-MAC.png)

## IP段格式

![ip](https://gitlab.com/iknowledge/CourseImage/-/raw/main/Network/ip.png)

- 协议版本: ipv4, ipv6
- 16位总长度: 最大65536
- 8位生存时间ttl(网络连接下一跳的次数): 为了防止网络阻塞，源主机为数据包设定一个生存时间，比如64，每过一个路由器就把该值减1，如果减到0就表示路由已经太长了仍然找不到目的主机的网络，就丢弃该包，因此这个生存时间的单位不是秒，而是跳（hop）。
- 32位源ip地址, 共个4字节！我们熟悉的ip都是点分十进制的，4字节, 每字节对应一个点分位，最大为255 ，实际上就是整形数！
- 32位目的ip地址 
- 8位协议: 用来区分上层协议是TCP, UDP, ICMP还是IGMP协议.
- 16位首部校验和: 只校验IP首部, 数据的校验由更高层协议负责.

## UDP数据报格式

面向无连接的，不安全的，不可靠的数据报传输。

![udp](https://gitlab.com/iknowledge/CourseImage/-/raw/main/Network/udp.png)

## TCP数据流格式

面向连接的，安全的，可靠的数据流传输协议。

![tcp](https://gitlab.com/iknowledge/CourseImage/-/raw/main/Network/tcp.png)

- 序号: TCP是安全可靠的, 每个数据包都带有序号, 当数据包丢失的时候, 需要重传, 要使用序号进行重传. 控制数据有序, 丢包重传。
- 确认序号: 使用确认序号可以知道对方是否已经收到了, 通过确认序号可以知道哪个序号的数据需要重传。
- 16位窗口大小--滑动窗口(主要进行流量控制)

## 字节序问题

- 大端字节序:也叫高端字节序(网络字节序), 是高端地址存放低位数据, 低端地址存放高位数据
- 小端字节序:也叫低端字节序, 是低地址存放低位数据, 高地址存放高位数据

如何验证本机上大端还是小端？————使用共用体。
